
@{
    ViewBag.Title = "IndexFaturalandi";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}


<link href="~/smartadmin-html-full/dist/css/datagrid/datatables/datatables.bundle.css" rel="stylesheet" media="screen, print" />
<link href="~/smartadmin-html-full/dist/css/formplugins/select2/select2.bundle.css" rel="stylesheet" />
<link href="~/smartadmin-html-full/dist/css/formplugins/bootstrap-daterangepicker/bootstrap-daterangepicker.css" rel="stylesheet" />
<div class="row">


    <div class="col-sm-6 col-xl-2">
        <a href="/Dosyalar/IndexYeniDosya">
            <div class="p-lg-5 bg-info-200 rounded overflow-hidden position-relative text-white mb-g">
                <div>
                    <h3 class="display-4 d-block l-h-n m-0 fw-500">
                        Yeni Dosya<small class="m-0 l-h-n">@ViewBag.YeniDosya</small>
                    </h3>
                </div>
                <i class="fal fa-user position-absolute pos-right pos-bottom opacity-15 mb-n1 mr-n1" style="font-size:6rem">…</i>

            </div>
        </a>
    </div>
    <div class="col-sm-6 col-xl-2">
        <a href="/Dosyalar/IndexEksperInceliyor">
            <div class="p-lg-5 bg-primary-300 rounded overflow-hidden position-relative text-white mb-g">
                <div>
                    <h3 class="display-4 d-block l-h-n m-0 fw-500">
                        İnceliyor<small class="m-0 l-h-n"> @ViewBag.EksperInceliyor</small>
                    </h3>
                </div>
                <i class="fal fa-user position-absolute pos-right pos-bottom opacity-15 mb-n1 mr-n1" style="font-size:6rem">…</i>

            </div>
        </a>
    </div>
    <div class="col-sm-6 col-xl-2">
        <a href="/Dosyalar/IndexOnarimda">
            <div class="p-lg-5 bg-warning-400 rounded overflow-hidden position-relative text-white mb-g">
                <div>
                    <h3 class="display-4 d-block l-h-n m-0 fw-500">
                        Onarımda<small class="m-0 l-h-n">@ViewBag.Onarimda</small>
                    </h3>
                </div>
                <i class="fal fa-user position-absolute pos-right pos-bottom opacity-15 mb-n1 mr-n1" style="font-size:6rem">…</i>

            </div>
        </a>
    </div>
    <div class="col-sm-6 col-xl-2">
        <a href="/Dosyalar/IndexFaturalandi">
            <div class="p-lg-5 bg-success-200 rounded overflow-hidden position-relative text-white mb-g">
                <div>
                    <h3 class="display-4 d-block l-h-n m-0 fw-500">
                        Faturalandı<small class="m-0 l-h-n">@ViewBag.Faturalandi</small>
                    </h3>
                </div>
                <i class="fal fa-user position-absolute pos-right pos-bottom opacity-15 mb-n1 mr-n1" style="font-size:6rem">…</i>

            </div>
        </a>
    </div>
    <div class="col-sm-6 col-xl-2">
        <a href="/Dosyalar/IndexFaturalandi">
            <div class="p-lg-5 bg-info-400 rounded overflow-hidden position-relative text-white mb-g">
                <div>
                    <h3 class="display-4 d-block l-h-n m-0 fw-500">
                        Faturalandı<small class="m-0 l-h-n">@ViewBag.Faturalandi</small>
                    </h3>
                </div>
                <i class="fal fa-user position-absolute pos-right pos-bottom opacity-15 mb-n1 mr-n1" style="font-size:6rem">…</i>

            </div>
        </a>
    </div>
    <div class="col-sm-6 col-xl-2">
        <a href="/Dosyalar/IndexFaturalandi">
            <div class="p-lg-5 bg-primary-600 rounded overflow-hidden position-relative text-white mb-g">
                <div>
                    <h3 class="display-4 d-block l-h-n m-0 fw-500">
                        Faturalandı<small class="m-0 l-h-n">@ViewBag.Faturalandi</small>
                    </h3>
                </div>
                <i class="fal fa-user position-absolute pos-right pos-bottom opacity-15 mb-n1 mr-n1" style="font-size:6rem">…</i>

            </div>
        </a>
    </div>

</div>

<div class="modal-body">
    <div class="panel" id="PanelHidden">
        <div class="panel-hdr bg-danger-900 bg-info-gradient">
            <h2 class="IslemTip">Dosya Arama</h2>
            <div class="panel-toolbar">
                <button class="btn btn-panel waves-effect waves-themed" data-action="panel-collapse" data-toggle="tooltip" data-offset="0,10" data-original-title="Aç/Kapat"></button>
            </div>
        </div>
        <div class="panel-container show">
            <div class="panel-content">
                <div class="row m-auto">

                    <div class="col-lg-6 col-md-12">
                        <div class="form-group">
                            <label class="col-form-label"><strong>Dosya No</strong></label>
                            <input type="text" id="DosyaNo" name="DosyaNo" class="form-control border-top-left-radius-3 border-bottom-left-radius-3" />
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-12">
                        <div class="form-group">
                            <label class="col-form-label"><strong>Araç Plaka</strong></label>
                            <input type="text" id="AracPlaka" name="AracPlaka" class="form-control border-top-left-radius-3 border-bottom-left-radius-3" />
                        </div>
                    </div>
                </div>
                <div class="row m-auto">

                    <div class="col-lg-6 col-md-12">
                        <div class="form-group">
                            <label class="col-form-label"><strong>Sigorta Şirketi</strong></label>
                            <input type="text" id="SigortaSirketi" name="SigortaSirketi" class="form-control border-top-left-radius-3 border-bottom-left-radius-3" />
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-12">
                        <div class="form-group">
                            <label class="col-form-label"><strong>Marka</strong></label>
                            <input type="text" id="Marka" name="Marka" class="form-control border-top-left-radius-3 border-bottom-left-radius-3" />
                        </div>
                    </div>
                </div>
                <div class="row m-auto">

                    @*<div class="col-lg-6 col-md-12">
                        <div class="form-group ">
                            <label class="col-form-label"><strong>Onarım İhbar Tarihi</strong></label>
                            <input type="text" class="form-control" id="OnarimIhbarTarihi">
                        </div>
                    </div>*@
                    <div class="col-lg-6 col-md-12">
                        <div class="form-group ">
                            <label class="col-form-label"><strong>Cevap Tarihi</strong></label>
                            <input type="text" class="form-control" id="CevapTarihi">
                        </div>
                    </div>
                </div>

                <div class="row m-auto">
                    <div class="col-lg-6 col-md-12">
                        <div class="form-group">
                            <label class="col-form-label"><strong>Dosya Durumu</strong></label>
                            <select class="select2 form-control w-100 is-invalid" id="DosyaDurumu" name="DosyaDurumu">
                                <option value="0"> </option>
                                <option value="1">Yeni Kayıt </option>
                                <option value="2">Eksper İnceliyor </option>
                                <option value="3">Onarımda </option>
                                <option value="4">Faturalandı </option>
                                <option value="5">Tamamlandı </option>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-12">
                        <div class="form-group ">
                            <label class="col-form-label"><strong>Dosya Kapatma Tarihi</strong></label>
                            <input type="text" class="form-control" id="DosyaKapatmaTarihi">
                        </div>
                    </div>
                </div>
                <div class="ml-6 mt-4 mb-2 d-flex justify-content-end">
                    <div class="center">
                        <button type="submit" class="btn btn-success" onclick="ListeleButtonClick()"> Listele </button>
                        <input type="hidden" id=" " name=" " value=" " />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="panel">
        <div class="panel-hdr bg-danger-900 bg-info-gradient">
            <h2>Dosya Listesi </h2>
            <div class="panel-toolbar">
            </div>
        </div>
        <div class="panel-container show">
            <div class="panel-content">
                <div class="row m-auto">

                    <div class="col-lg-3 col-md-12">
                        <div class="form-group ">
                            <label class="col-form-label"><strong>Onarım İhbar Tarihi</strong></label>
                            <input type="text" class="form-control" id="OnarimIhbarTarihi">
                        </div>
                        <div class="ml-6 mt-4 mb-2 d-flex justify-content-end">
                            <div class="center">
                                <button type="submit" class="btn btn-success" onclick="ListeleButtonClick()"> Listele </button>
                                <input type="hidden" id=" " name=" " value=" " />
                            </div>
                        </div>
                    </div>
                </div><br />
                <div id="TableDiv"></div>
            </div>
        </div>
    </div>
</div>

@section ScriptsBlock{
    <script src="~/smartadmin-html-full/dist/js/datagrid/datatables/datatables.bundle.js"></script>
    <script src="~/smartadmin-html-full/dist/js/datagrid/datatables/datatables.export.js"></script>
    <script src="~/smartadmin-html-full/dist/js/formplugins/select2/select2.bundle.js"></script>
    <script src="~/Scripts/DropDown.js"></script>
    <script src="~/smartadmin-html-full/dist/js/dependency/moment/moment.js"></script>
    <script src="~/smartadmin-html-full/dist/js/formplugins/bootstrap-daterangepicker/bootstrap-daterangepicker.js"></script>
    <script>
        $("#PanelHidden").hide();
        var KapatmailkTarih = '';
        var KapatmasonTarih = '';
        var CevapilkTarih = '';
        var CevapsonTarih = '';
        var OnarimIhbarilkTarih = '';
        var OnarimIhbarsonTarih = '';
        Tablo();
        DosyaListesi();
        Daterangepicker();
        function Daterangepicker() {
            $('#OnarimIhbarTarihi').daterangepicker(
                {
                    "showDropdowns": true,
                    "showWeekNumbers": false,
                    "showISOWeekNumbers": false,
                    "timePicker": false,
                    "timePicker24Hour": false,
                    "timePickerSeconds": false,
                    "autoApply": true,
                    "maxSpan":
                    {
                        "days": 30
                    },
                    locale: {
                        format: "DD/MM/yy",

                        monthNames: ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"],
                        dayNamesMin: ["Pa", "Pt", "Sl", "Ça", "Pe", "Cu", "Ct"],
                        firstDay: 1
                    },
                    ranges:
                    {
                        'Bugün': [moment(), moment()],
                        'Dün': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                        'Son 7 Gün': [moment().subtract(6, 'days'), moment()],
                        'Son 30 Gün': [moment().subtract(29, 'days'), moment()],
                        'Bu Ay': [moment().startOf('month'), moment().endOf('month')],
                        'Geçen Ay': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                    },
                    "alwaysShowCalendars": true,
                    "applyButtonClasses": "btn-default shadow-0",
                    "cancelClass": "btn-success shadow-0"
                }, function (start, end, label) {
                    console.log('New date range selected: ' + start.format('DD/MM/YYYY') + ' to ' + end.format('DD/MM/YYYY') + ' (predefined range: ' + label + ')');

                });
            $('#CevapTarihi').daterangepicker(
                {
                    "showDropdowns": true,
                    "showWeekNumbers": false,
                    "showISOWeekNumbers": false,
                    "timePicker": false,
                    "timePicker24Hour": false,
                    "timePickerSeconds": false,
                    "autoApply": true,
                    "maxSpan":
                    {
                        "days": 30
                    },
                    locale: {
                        format: "DD/MM/yy",

                        monthNames: ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"],
                        dayNamesMin: ["Pa", "Pt", "Sl", "Ça", "Pe", "Cu", "Ct"],
                        firstDay: 1
                    },
                    ranges:
                    {
                        'Bugün': [moment(), moment()],
                        'Dün': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                        'Son 7 Gün': [moment().subtract(6, 'days'), moment()],
                        'Son 30 Gün': [moment().subtract(29, 'days'), moment()],
                        'Bu Ay': [moment().startOf('month'), moment().endOf('month')],
                        'Geçen Ay': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                    },
                    "alwaysShowCalendars": true,
                    "applyButtonClasses": "btn-default shadow-0",
                    "cancelClass": "btn-success shadow-0"
                }, function (start, end, label) {
                    console.log('New date range selected: ' + start.format('DD/MM/YYYY') + ' to ' + end.format('DD/MM/YYYY') + ' (predefined range: ' + label + ')');

                });
            $('#DosyaKapatmaTarihi').daterangepicker(
                {
                    "showDropdowns": true,
                    "showWeekNumbers": false,
                    "showISOWeekNumbers": false,
                    "timePicker": false,
                    "timePicker24Hour": false,
                    "timePickerSeconds": false,
                    "autoApply": true,
                    "maxSpan":
                    {
                        "days": 30
                    },
                    locale: {
                        format: "DD/MM/yy",

                        monthNames: ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"],
                        dayNamesMin: ["Pa", "Pt", "Sl", "Ça", "Pe", "Cu", "Ct"],
                        firstDay: 1
                    },
                    ranges:
                    {
                        'Bugün': [moment(), moment()],
                        'Dün': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                        'Son 7 Gün': [moment().subtract(6, 'days'), moment()],
                        'Son 30 Gün': [moment().subtract(29, 'days'), moment()],
                        'Bu Ay': [moment().startOf('month'), moment().endOf('month')],
                        'Geçen Ay': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                    },
                    "alwaysShowCalendars": true,
                    "applyButtonClasses": "btn-default shadow-0",
                    "cancelClass": "btn-success shadow-0"
                }, function (start, end, label) {
                    console.log('New date range selected: ' + start.format('DD/MM/YYYY') + ' to ' + end.format('DD/MM/YYYY') + ' (predefined range: ' + label + ')');

                });
            $('#DosyaKapatmaTarihi').on("change", function () {
                var selected = $(this).val();

                var ilkgun = selected.slice(0, 2);
                var ilkay = selected.slice(3, 5);
                var ilkyil = selected.slice(6, 10);
                KapatmailkTarih = ilkay + "/" + ilkgun + "/" + ilkyil;

                var songun = selected.slice(13, 15);
                var sonay = selected.slice(16, 18);
                var sonyil = selected.slice(19, 23);
                KapatmasonTarih = sonay + "/" + songun + "/" + sonyil;

            });
            $('#CevapTarihi').on("change", function () {
                var selected = $(this).val();

                var ilkgun = selected.slice(0, 2);
                var ilkay = selected.slice(3, 5);
                var ilkyil = selected.slice(6, 10);
                CevapilkTarih = ilkay + "/" + ilkgun + "/" + ilkyil;

                var songun = selected.slice(13, 15);
                var sonay = selected.slice(16, 18);
                var sonyil = selected.slice(19, 23);
                CevapsonTarih = sonay + "/" + songun + "/" + sonyil;

            });
            $('#OnarimIhbarTarihi').on("change", function () {
                var selected = $(this).val();

                var ilkgun = selected.slice(0, 2);
                var ilkay = selected.slice(3, 5);
                var ilkyil = selected.slice(6, 10);
                OnarimIhbarilkTarih = ilkay + "/" + ilkgun + "/" + ilkyil;

                var songun = selected.slice(13, 15);
                var sonay = selected.slice(16, 18);
                var sonyil = selected.slice(19, 23);
                OnarimIhbarsonTarih = sonay + "/" + songun + "/" + sonyil;

            });
        };
        function Tablo() {
            var tbl = '<table id="dt-basic-example" class="table  table-hover table-light table-responsive-sm table-light table-striped "><thead class=" bg-info-900 "><tr><th>Onarım İhbar Tarihi</th><th>Sigorta Şirketi</th><th>Dosya No</th><th>Plaka</th><th>Dosya Durumu</th><th>Cevap Tarihi</th><th>İşlemler</th></tr></thead><tbody></tbody></table>';
            $('#TableDiv').append(tbl);

        };
        function DosyaListesi() {

            var DosyaNo = $("#DosyaNo").val();
            var AracPlaka = $("#AracPlaka").val();
            var SigortaSirketi = $("#SigortaSirketi").val();
            var Marka = $("#Marka").val();
            var DosyaDurumu = $("#DosyaDurumu").val();

            $("#dt-basic-example tbody tr").remove();
            $.post("/Dosyalar/DosyaListeGetir",
                {
                    DosyaNo: DosyaNo,
                    AracPlaka: AracPlaka,
                    SigortaSirketi: SigortaSirketi,
                    Marka: Marka,
                    KapatmailkTarih: KapatmailkTarih,
                    KapatmasonTarih: KapatmasonTarih,
                    CevapilkTarih: CevapilkTarih,
                    CevapsonTarih: CevapsonTarih,
                    OnarimIhbarilkTarih: OnarimIhbarilkTarih,
                    OnarimIhbarsonTarih: OnarimIhbarsonTarih,
                    DosyaDurumu: DosyaDurumu,
                },
                function (data, status) {
                    var i = 0;
                    var deger = null;
                    var dosyaDurumu = null;
                    $.each(data, function () {
                        var dAcilisTarih = moment(data[i].DAcilisTarih).format('DD/MM/YYYY');
                        var dKabulTarih = moment(data[i].DKabulTarih).format('DD/MM/YYYY');
                        var dKapanisTarih = moment(data[i].DKapanisTarih).format('DD/MM/YYYY');
                        if (dKapanisTarih == "01/01/0001") {
                            dKapanisTarih = "Dosya kapatılmadı.";
                        }
                        if (data[i].DosyaDurum == 4) {
                            dosyaDurumu = $("#DosyaDurumu").children('option').eq(data[i].DosyaDurum).text()
                            deger = '<tr><input type="hidden" id="' + data[i].DosyaID + '" name="' + data[i].DosyaID + '" value="' + data[i].DosyaID + '" /><td>' + dAcilisTarih + '</td><td>' + data[i].SigortaSirketi + '</td><td>' + data[i].DosylarNo + '</td><td>' + data[i].AracPlaka + '</td><td>' + dosyaDurumu + '</td><td>' + dKabulTarih + '</td><td> <a href="/Dosyalar/DosyaGuncelle?id=' + data[i].DosyaID + '" title="Güncelle" class="btn btn-success btn-icon rounded-circle mr-1"><i class="fal fa-edit"></i></a></td></tr>';
                            $("#dt-basic-example tbody").append(deger);
                        }
                        i++;
                    });
                    LoadTable();
                });
        };
        function LoadTable() {
            $('#dt-basic-example thead tr').clone(true).appendTo('#dt-basic-example thead');
            $('#dt-basic-example thead tr:eq(1) th').each(function (i) {
                var title = $(this).text();
                $(this).html('<input type="text" class="form-control form-control-sm" placeholder="' + title + '" />');

                $('input', this).on('keyup change', function () {
                    if (table.column(i).search() !== this.value) {
                        table
                            .column(i)
                            .search(this.value)
                            .draw();
                    }
                });
            });
            var table = $('#dt-basic-example').DataTable(
                {
                    orderCellsTop: true,
                    fixedHeader: true,
                    responsive: true,
                    lengthChange: false,
                    dom:
                        "<'row mb-3'<'col-sm-12 col-md-6 d-flex align-items-center justify-content-start'f><'col-sm-12 col-md-6 d-flex align-items-center justify-content-end'lB>>" +
                        "<'row'<'col-sm-12'tr>>" +
                        "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
                    buttons: [
                        {
                            extend: 'colvis',
                            text: 'Sütun Seç',
                            titleAttr: 'Görüntülenecek sütunlar',
                            className: 'mr-sm-3'
                        },
                        {
                            extend: 'pdfHtml5',
                            text: 'PDF',
                            titleAttr: 'Generate PDF',
                            className: 'btn-outline-danger btn-sm mr-1'
                        },
                        {
                            extend: 'excelHtml5',
                            text: 'Excel',
                            titleAttr: 'Generate Excel',
                            className: 'btn-outline-success btn-sm mr-1'
                        },
                        {
                            extend: 'csvHtml5',
                            text: 'CSV',
                            titleAttr: 'Generate CSV',
                            className: 'btn-outline-primary btn-sm mr-1'
                        },
                        {
                            extend: 'copyHtml5',
                            text: 'Kopyala',
                            titleAttr: 'Copy to clipboard',
                            className: 'btn-outline-primary btn-sm mr-1'
                        },
                        {
                            extend: 'print',
                            text: 'Yazdır',
                            titleAttr: 'Tabloyu Yazdır',
                            className: 'btn-outline-primary btn-sm'
                        }
                    ]
                });
        };
        function ListeleButtonClick() {
            $("#TableDiv").empty();
            Tablo();
            DosyaListesi();
        };
    </script>
}
